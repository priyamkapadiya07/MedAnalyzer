{% extends 'base.html' %} {% block content %}{% load custom_filters %}

<div class="report-card stacked">
  <div class="report-header centered">
    <h1 class="main-title">ðŸ§¾ Medical Report Summary</h1>
    <p class="upload-date">
      Uploaded On: {{ report.uploaded_at|date:"d M Y, h:i A" }}
    </p>
  </div>

  <div class="report-details-stacked">
    <div class="report-section">
      <h2>ðŸ“Š Extracted Values</h2>
      <ul>
        {% for key, value in report.extracted_data.items %}
        <li>
          <strong>{{ key }}</strong>: {{ value }}
          {% with test_units|get_item:key as unit %} {% if unit %}
          <span style="color: #555">{{ unit }}</span>
          {% endif %} {% endwith %}
        </li>
        {% endfor %}
      </ul>
    </div>

    {% if graph %}
    <div class="report-section">
      <h2>ðŸ“ˆ Report Visualization</h2>
      <img src="data:image/png;base64,{{ graph }}" class="img-fluid" alt="Report Graph" />
    </div>
    {% endif %}


    <div class="report-section">
      <h2>ðŸ§¬ Disease Prediction</h2>
      <ul>
        {% for disease, status in report.diseases_detected.items %}
        <li><strong>{{ disease }}</strong>: {{ status }}</li>
        {% endfor %}
      </ul>
    </div>

    <div class="report-section">
      <h2>ðŸ’Š Suggested Medicines</h2>
      <ul>
        {% for disease, meds in report.medicine_suggestions.items %}
        <li>
          <strong>{{ disease }}:</strong>
          <ul>
            {% for med in meds %}
            <li>{{ med }}</li>
            {% endfor %}
          </ul>
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <a href="{% url 'reports' %}" class="btn-back"
    ><i class="fa-solid fa-hand-point-left"></i> Back to Reports</a
  >
  <a
    href="#"
    class="btn btn-download btn-info"
    data-bs-toggle="modal"
    data-bs-target="#downloadModal">
    <i class="fa-solid fa-download"></i> Download
  </a>

  <div class="modal fade" id="downloadModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-3">
        <div class="modal-header">
          <h5 class="modal-title">Choose Action</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <p>What would you like to do with your report?</p>

          <a
            href="{% url 'handle_report' report.id 'download' %}"
            class="btn btn-primary m-2">
            <i class="fa fa-file-pdf"></i> Download as PDF
          </a>

          <form
            action="{% url 'handle_report' report.id 'email' %}"
            method="POST"
            class="mt-3">
            {% csrf_token %}
            <input
              type="email"
              name="email"
              placeholder="Enter email"
              value="{{email}}"
              required
              class="form-control mb-2"
              style="background-color: transparent" />
            <button type="submit" class="btn btn-success">
              <i class="fa fa-envelope"></i> Send to This Email
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .btn-download {
    display: inline-block;
    margin-left: 10px;
    margin-top: -4px;
    padding: 10px;
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-weight: 500;
    transition: background-color 0.3s ease;
  }
</style>
{% endblock %}
